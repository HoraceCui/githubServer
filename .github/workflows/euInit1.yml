
name: euInit1
on:
  workflow_dispatch:
    inputs:
      ssh_addr:
        description: 'è¿œç¨‹æœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤ 	1:1:1:1:1:1:1:1'
        required: false
        default: '1:1:1:1:1:1:1:1'
      ssh_user:
        description: 'è¿œç¨‹æœåŠ¡å™¨ç”¨æˆ·åï¼ˆé»˜è®¤ root)'
        required: false
        default: 'root'
      ssh_port:
        description: 'SSH ç«¯å£ï¼ˆé»˜è®¤ 22)'
        required: false
        default: '22'
      ssh_password:
        description: 'è¿œç¨‹ç”¨æˆ·å¯†ç '
        required: true

jobs:
   remote-ssh:  
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up WARP
        uses: fscarmen/warp-on-actions@v1.3
        with:
          stack: ipv6        # Optional. Support [ ipv4, ipv6, dual ]. Default is dual.
          mode: client    # Optional. Support [ wireguard, client ]. Default is wireguard.

      - name: ğŸ“¦ Init
        env:
          HOST_IP: ${{ github.event.inputs.ssh_addr }}     # IP åœ°å€
          SSH_USER: ${{ github.event.inputs.ssh_user }}     # ç”¨æˆ·å
          SSH_PASS: ${{ github.event.inputs.ssh_password }}      # å¯†ç 
          SSH_PORT: ${{ github.event.inputs.ssh_port }}      # ç«¯å£
        run: |
          sudo apt update && sudo apt install -y sshpass
          echo ${GITHUB_WORKSPACE}
          cd ${GITHUB_WORKSPACE}/eu
          cp config_init config_new
          sed -i "s/^[[:space:]]*HostName .*/    HostName $HOST_IP/" config_new
          sed -i "s/^[[:space:]]*Port .*/    Port $SSH_PORT/" config_new
          sed -i "s/^[[:space:]]*User .*/    User $SSH_USER/" config_new
          ls -al
          cat config_new
          echo "ğŸ“¤ ä½¿ç”¨ ssh æ‰§è¡Œ "myServer" 'sudo apt update && sudo apt upgrade -y && sudo reboot'.."
          #sshpass -p "$SSH_PASS" scp -F config_new scripts.tar.gz "myServer:/tmp/"
          sshpass -p "$SSH_PASS" ssh -F config_new "myServer" 'apt update && apt install sudo zip unzip curl gpg lsb-release -y && sudo apt upgrade -y && sudo reboot'
          echo "ğŸ“¤ æˆåŠŸ..."

