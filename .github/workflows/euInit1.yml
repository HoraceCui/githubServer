
name: euInit1
on:
  workflow_dispatch:
    inputs:
      ssh_addr:
        description: '远程服务器地址（默认 	1:1:1:1:1:1:1:1'
        required: false
        default: '1:1:1:1:1:1:1:1'
      ssh_user:
        description: '远程服务器用户名（默认 root)'
        required: false
        default: 'root'
      ssh_port:
        description: 'SSH 端口（默认 22)'
        required: false
        default: '22'
      ssh_password:
        description: '远程用户密码'
        required: true

jobs:
   remote-ssh:  
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up WARP
        uses: fscarmen/warp-on-actions@v1.3
        with:
          stack: ipv6        # Optional. Support [ ipv4, ipv6, dual ]. Default is dual.
          mode: client    # Optional. Support [ wireguard, client ]. Default is wireguard.

      - name: 📦 Init
        env:
          HOST_IP: ${{ github.event.inputs.ssh_addr }}     # IP 地址
          SSH_USER: ${{ github.event.inputs.ssh_user }}     # 用户名
          SSH_PASS: ${{ github.event.inputs.ssh_password }}      # 密码
          SSH_PORT: ${{ github.event.inputs.ssh_port }}      # 端口
        run: |
          sudo apt update && sudo apt install -y sshpass
          echo ${GITHUB_WORKSPACE}
          cd ${GITHUB_WORKSPACE}/eu
          cp config_init config_new
          sed -i "s/^[[:space:]]*HostName .*/    HostName $HOST_IP/" config_new
          sed -i "s/^[[:space:]]*Port .*/    Port $SSH_PORT/" config_new
          sed -i "s/^[[:space:]]*User .*/    User $SSH_USER/" config_new
          ls -al
          cat config_new
          echo "📤 使用 ssh 执行 "myServer" 'sudo apt update && sudo apt upgrade -y && sudo reboot'.."
          #sshpass -p "$SSH_PASS" scp -F config_new scripts.tar.gz "myServer:/tmp/"
          sshpass -p "$SSH_PASS" ssh -F config_new "myServer" 'apt update && apt install sudo zip unzip curl gpg lsb-release -y && sudo apt upgrade -y && sudo reboot'
          echo "📤 成功..."

